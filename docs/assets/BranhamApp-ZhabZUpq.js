import{r as c,J as ws,W as st,j as e,I as u,M as _e,R as Ct,B as vs,C as St,X as $t,Y as Tt,T as Mt,a as Ns,b as ks,c as Rt,d as Cs,S as je,e as Ss,L as $s,A as Lt,f as Dt,V as Ts,g as Ms,h as Rs}from"./index-QS4V-txC.js";class Ls extends c.Component{constructor(h){super(h),this.state={hasError:!1,error:null}}static getDerivedStateFromError(h){return{hasError:!0,error:h}}componentDidCatch(h,P){console.error("Uncaught error:",h,P)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-red-50 p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-xl border border-red-200 max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Application Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"A critical error stopped the dashboard."}),e.jsx("div",{className:"text-left bg-gray-100 p-2 rounded text-xs text-red-800 font-mono mb-4 overflow-auto max-h-32",children:this.state.error&&this.state.error.toString()}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white font-bold py-2 px-6 rounded hover:bg-red-700 transition",children:"Reload Page"})]})}):this.props.children}}const Ds="",Es="",Ve=k=>decodeURIComponent(k).split("/").map(P=>P.replace(/ /g,"%20").replace(/#/g,"%23")).join("/"),Et=k=>{if(!k||typeof k!="string")return null;const h=k.trim(),P=h.match(/^(.+?)\s+ONEAR\/(\d+)\s+(.+)$/i);if(P)return{type:"onear",terms:[P[1].trim(),P[3].trim()],distance:parseInt(P[2],10),ordered:!0,excluded:[]};const F=h.match(/^(.+?)\s+(?:NEAR\/(\d+)|~(\d+)|AROUND\((\d+)\))\s+(.+)$/i);if(F)return{type:"near",terms:[F[1].trim(),F[5].trim()],distance:parseInt(F[2]||F[3]||F[4],10),excluded:[]};const X=h.match(/^(.+?)\s+(?:\/s|SENTENCE)\s+(.+)$/i);if(X)return{type:"sentence",terms:[X[1].trim(),X[2].trim()],excluded:[]};const Q=h.match(/^(.+?)\s+(?:\/p|PARAGRAPH)\s+(.+)$/i);if(Q)return{type:"paragraph",terms:[Q[1].trim(),Q[2].trim()],excluded:[]};const Ae=h.match(/^"([^"]+)"$/);if(Ae)return{type:"phrase",phrase:Ae[1],excluded:[]};if(h.includes("(?=")&&h.includes(".*")){const N=[...h.matchAll(/\(\?=\.\*(?:\\b)?(\w+)(?:\\b)?\)/g)].map(Ke=>Ke[1]).filter(Boolean);if(N.length>=2)return{type:"and",required:N,excluded:[]}}let C=[],w=h;if(/\sNOT\s/i.test(w)){const v=w.split(/\s+NOT\s+/i);w=v[0].trim(),C=v.slice(1).map(N=>N.trim()).filter(Boolean)}const oe=[...w.matchAll(/(?:^|\s)[-!](\w+)/g)];if(oe.length>0&&(C=[...C,...oe.map(v=>v[1])],w=w.replace(/(?:^|\s)[-!]\w+/g," ").trim()),/\sOR\s/i.test(w)){const v=w.split(/\s+OR\s+/i).map(N=>N.trim()).filter(Boolean);if(v.length>=2||C.length>0)return{type:"or",required:v,excluded:C}}if(/\s*\|\s*/.test(w)){const v=w.split(/\s*\|\s*/).map(N=>N.trim()).filter(Boolean);if(v.length>=2||C.length>0)return{type:"or",required:v,excluded:C}}if(/\sAND\s/i.test(w)){const v=w.split(/\s+AND\s+/i).map(N=>N.trim()).filter(Boolean);if(v.length>=2||C.length>0)return{type:"and",required:v,excluded:C}}if(/^\+\S/.test(w)&&w.includes(" +")){const v=w.split(/\s+/).filter(N=>N.startsWith("+")).map(N=>N.slice(1).trim()).filter(Boolean);if(v.length>=2||C.length>0)return{type:"and",required:v,excluded:C}}if(/\s*&\s*/.test(w)&&!w.includes("|")){const v=w.split(/\s*&\s*/).map(N=>N.trim()).filter(Boolean);if(v.length>=2||C.length>0)return{type:"and",required:v,excluded:C}}return C.length>0&&w.trim()?{type:"and",required:[w.trim()],excluded:C}:null},As=/\b(Genesis|Exodus|Leviticus|Numbers|Deuteronomy|Joshua|Judges|Ruth|(?:1|2|I|II)\s*Samuel|(?:1|2|I|II)\s*Kings|(?:1|2|I|II)\s*Chronicles|Ezra|Nehemiah|Esther|Job|Psalms?|Proverbs|Ecclesiastes|Song\s*of\s*Solomon|Isaiah|Jeremiah|Lamentations|Ezekiel|Daniel|Hosea|Joel|Amos|Obadiah|Jonah|Micah|Nahum|Habakkuk|Zephaniah|Haggai|Zechariah|Malachi|Matthew|Mark|Luke|John|Acts|Romans|(?:1|2|I|II)\s*Corinthians|Galatians|Ephesians|Philippians|Colossians|(?:1|2|I|II)\s*Thessalonians|(?:1|2|I|II)\s*Timothy|Titus|Philemon|Hebrews|James|(?:1|2|I|II)\s*Peter|(?:1|2|3|I|II|III)\s*John|Jude|Revelation|Rev\.?|Gen\.?|Ex\.?|Lev\.?|Num\.?|Deut\.?|Josh\.?|Judg\.?|(?:1|2)\s*Sam\.?|(?:1|2)\s*Kgs\.?|(?:1|2)\s*Chr\.?|Neh\.?|Esth\.?|Ps\.?|Prov\.?|Eccl\.?|Isa\.?|Jer\.?|Lam\.?|Ezek\.?|Dan\.?|Hos\.?|Obad\.?|Mic\.?|Nah\.?|Hab\.?|Zeph\.?|Hag\.?|Zech\.?|Mal\.?|Matt\.?|Mk\.?|Lk\.?|Jn\.?|Rom\.?|(?:1|2)\s*Cor\.?|Gal\.?|Eph\.?|Phil\.?|Col\.?|(?:1|2)\s*Thess\.?|(?:1|2)\s*Tim\.?|Tit\.?|Phlm\.?|Heb\.?|Jas\.?|(?:1|2)\s*Pet\.?|(?:1|2|3)\s*Jn\.?|Rev\.?)\s*(\d+)(?::(\d+)(?:-(\d+))?)?\b/gi,zs=k=>{const h=k.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim();return{gen:"Genesis",genesis:"Genesis",ex:"Exodus",exodus:"Exodus",lev:"Leviticus",leviticus:"Leviticus",num:"Numbers",numbers:"Numbers",deut:"Deuteronomy",deuteronomy:"Deuteronomy",josh:"Joshua",joshua:"Joshua",judg:"Judges",judges:"Judges",ruth:"Ruth","1 sam":"1 Samuel","2 sam":"2 Samuel","i samuel":"1 Samuel","ii samuel":"2 Samuel","1 samuel":"1 Samuel","2 samuel":"2 Samuel","1 kgs":"1 Kings","2 kgs":"2 Kings","1 kings":"1 Kings","2 kings":"2 Kings","i kings":"1 Kings","ii kings":"2 Kings","1 chr":"1 Chronicles","2 chr":"2 Chronicles","1 chronicles":"1 Chronicles","2 chronicles":"2 Chronicles",ezra:"Ezra",neh:"Nehemiah",nehemiah:"Nehemiah",esth:"Esther",esther:"Esther",job:"Job",ps:"Psalms",psalm:"Psalms",psalms:"Psalms",prov:"Proverbs",proverbs:"Proverbs",eccl:"Ecclesiastes",ecclesiastes:"Ecclesiastes","song of solomon":"Song of Solomon",isa:"Isaiah",isaiah:"Isaiah",jer:"Jeremiah",jeremiah:"Jeremiah",lam:"Lamentations",lamentations:"Lamentations",ezek:"Ezekiel",ezekiel:"Ezekiel",dan:"Daniel",daniel:"Daniel",hos:"Hosea",hosea:"Hosea",joel:"Joel",amos:"Amos",obad:"Obadiah",obadiah:"Obadiah",jonah:"Jonah",mic:"Micah",micah:"Micah",nah:"Nahum",nahum:"Nahum",hab:"Habakkuk",habakkuk:"Habakkuk",zeph:"Zephaniah",zephaniah:"Zephaniah",hag:"Haggai",haggai:"Haggai",zech:"Zechariah",zechariah:"Zechariah",mal:"Malachi",malachi:"Malachi",matt:"Matthew",matthew:"Matthew",mk:"Mark",mark:"Mark",lk:"Luke",luke:"Luke",jn:"John",john:"John",acts:"Acts",rom:"Romans",romans:"Romans","1 cor":"1 Corinthians","2 cor":"2 Corinthians","1 corinthians":"1 Corinthians","2 corinthians":"2 Corinthians",gal:"Galatians",galatians:"Galatians",eph:"Ephesians",ephesians:"Ephesians",phil:"Philippians",philippians:"Philippians",col:"Colossians",colossians:"Colossians","1 thess":"1 Thessalonians","2 thess":"2 Thessalonians","1 thessalonians":"1 Thessalonians","2 thessalonians":"2 Thessalonians","1 tim":"1 Timothy","2 tim":"2 Timothy","1 timothy":"1 Timothy","2 timothy":"2 Timothy",tit:"Titus",titus:"Titus",phlm:"Philemon",philemon:"Philemon",heb:"Hebrews",hebrews:"Hebrews",jas:"James",james:"James","1 pet":"1 Peter","2 pet":"2 Peter","1 peter":"1 Peter","2 peter":"2 Peter","1 jn":"1 John","2 jn":"2 John","3 jn":"3 John","1 john":"1 John","2 john":"2 John","3 john":"3 John","i john":"1 John","ii john":"2 John","iii john":"3 John",jude:"Jude",rev:"Revelation",revelation:"Revelation"}[h]||k.charAt(0).toUpperCase()+k.slice(1)},Ps=k=>/[*?]/.test(k),Ws=k=>{let h=k.replace(/[.+^${}()|[\]\\]/g,"\\$&");return h=h.replace(/\*/g,"\\S*").replace(/\?/g,"."),h},Os=k=>{const h=k.trim();return h.startsWith('"')&&h.endsWith('"')||h.startsWith("'")&&h.endsWith("'")?h.slice(1,-1):h},he=(k,h=!0)=>{const P=Os(k);if(Ps(P)){const Q=Ws(P);return h?new RegExp(`\\b(${Q})\\b`,"gi"):new RegExp(`(${Q})`,"gi")}let F=P.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");F=F.replace(/'/g,"[''']?");const X=F.replace(/\s+/g,"\\s+");return h?new RegExp(`\\b(${X})\\b`,"gi"):new RegExp(`(${X})`,"gi")};function Fs({onSwitchToMain:k}){const[h,P]=c.useState([]),[F,X]=c.useState(!0),[Q,Ae]=c.useState(null),[C,w]=c.useState("wmb_api/"),[oe,v]=c.useState(0),[N,Ke]=c.useState(0),[at,At]=c.useState(null),[rt,zt]=c.useState(""),[nt,Pt]=c.useState(0),[Wt,Ot]=c.useState(0),[Bt,It]=c.useState({}),[ot,Ft]=c.useState([]),[y,ze]=c.useState(Ds),[le,Pe]=c.useState(Es),[xe,We]=c.useState(null),[Ht,we]=c.useState([]),[lt,ue]=c.useState(!1),[Jt,te]=c.useState({status:"",percent:0}),it=c.useRef({term:null,regex:null}),[Ut,$]=c.useState(""),[Bs,Oe]=c.useTransition(),[ve,ct]=c.useState([]),[Ne,dt]=c.useState([]),[se,mt]=c.useState([]),[Be,ht]=c.useState([]),ke=c.useCallback(t=>Oe(()=>ct(t)),[]),ie=c.useCallback(t=>Oe(()=>dt(t)),[]),Ce=c.useCallback(t=>Oe(()=>mt(t)),[]),xt=c.useCallback(t=>Oe(()=>ht(t)),[]),[Ye,_t]=c.useState(26),[Se,Vt]=c.useState("dashboard"),[ut,Kt]=c.useState(null),[ce,B]=c.useState(null),[Yt,H]=c.useState(0),[ae,Zt]=c.useState(!0),[ge,Ze]=c.useState("bars"),[$e,Ie]=c.useState(null),[Fe,Ge]=c.useState("grid"),[Gt,qt]=c.useState(new Set),[Xt,gt]=c.useState({}),[Qt,es]=c.useState({}),[He,Te]=c.useState(new Set(["Seven Church Ages","Seven Seals"])),[S,Me]=c.useState(null),[pt,bt]=c.useState({}),[Je,ts]=c.useState(!1),[qe,ft]=c.useState(""),[ss,Re]=c.useState({key:"date",direction:"desc"}),[Ue,yt]=c.useState(()=>{try{return JSON.parse(localStorage.getItem("wmb-search-history")||"[]")}catch{return[]}});c.useEffect(()=>{localStorage.setItem("wmb-search-history",JSON.stringify(Ue.slice(0,20)))},[Ue]);const as=c.useCallback(t=>{!t||t.trim().length<2||yt(n=>[{term:t.trim(),timestamp:Date.now()},...n.filter(s=>s.term!==t.trim())].slice(0,20))},[]),[pe,rs]=c.useState(()=>{try{return JSON.parse(localStorage.getItem("wmb-reading-progress")||"{}")}catch{return{}}});c.useEffect(()=>{localStorage.setItem("wmb-reading-progress",JSON.stringify(pe))},[pe]);const ns=c.useCallback((t,n)=>{rs(s=>({...s,[t]:{position:n,timestamp:Date.now()}}))},[]);c.useCallback(t=>pe[t],[pe]);const[Le,jt]=c.useState(!1),[q,os]=c.useState(null),be=c.useCallback(async(t,n,s=null)=>{if(!t||t.length===0){alert("No transcripts available to download");return}const o=t.filter(r=>r.path);if(o.length===0){alert("No downloadable transcripts found");return}Me({current:0,total:o.length,year:s});try{const r=new ws,l="https://pub-faafa72c17d7419b88e9ee13181643b9.r2.dev/";let a=0;for(let x=0;x<o.length;x++){const g=o[x];Me({current:x+1,total:o.length,year:s});try{const j=`${l}${Ve(g.path)}`,b=await fetch(j);if(b.ok){const f=await b.text(),p=g.path.split("/").pop();r.file(p,f),a++}}catch(j){console.warn(`Failed to fetch ${g.path}:`,j)}}if(a===0){alert("Could not download any transcripts. Please try downloading from Living Word Broadcast."),Me(null);return}const d=await r.generateAsync({type:"blob"}),i=URL.createObjectURL(d),m=document.createElement("a");m.href=i,m.download=n,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(i),Me(null)}catch(r){console.error("Error creating zip:",r),alert("Error creating download. Please try again or download from Living Word Broadcast."),Me(null)}},[]),Xe=c.useMemo(()=>({"Seven Church Ages":{dateCodes:["60-1205","60-1206","60-1207","60-1208","60-1209","60-1210","60-1211E"],color:"indigo",description:"December 5-11, 1960 - Branham Tabernacle"},"Seven Seals":{dateCodes:["63-0317E","63-0318","63-0319","63-0320","63-0321","63-0322","63-0323","63-0324E"],color:"amber",description:"March 17-24, 1963 - Branham Tabernacle"}}),[]),ls=c.useCallback(t=>{const n=Xe[t];return n?h.filter(s=>n.dateCodes.some(o=>s.dateCode===o||s.id?.startsWith(o))).sort((s,o)=>(s.date||"").localeCompare(o.date||"")):[]},[h,Xe]),is=c.useCallback((t,n=5)=>{if(!t||!h.length)return[];const s=[],o=new Date(t.timestamp);return h.forEach(r=>{if(r.id===t.id)return;let l=0;if(t.topics&&r.topics){const i=t.topics.filter(m=>r.topics.includes(m)).length;l+=i*10}t.venue&&r.venue===t.venue&&(l+=5);const a=new Date(r.timestamp),d=Math.abs((o-a)/(1e3*60*60*24));d<=7?l+=8:d<=30?l+=4:d<=90&&(l+=2),l>0&&s.push({...r,relatedScore:l})}),s.sort((r,l)=>l.relatedScore-r.relatedScore).slice(0,n)},[h]),cs=c.useCallback(async()=>{if(Le)return;jt(!0);const t=new Map,n=50;try{for(let o=0;o<oe;o+=n){const r=[];for(let a=o;a<Math.min(o+n,oe);a++)r.push(fetch(`${C}text_chunk_${a}.json`).then(d=>d.ok?d.json():[]).catch(()=>[]));const l=await Promise.all(r);for(const a of l)for(const d of a){let i;const m=new RegExp(As.source,"gi");for(;(i=m.exec(d.text))!==null;){const x=zs(i[1]),g=i[2],j=i[3]||"",b=j?`${x} ${g}:${j}`:`${x} ${g}`;t.has(x)||t.set(x,{count:0,refs:new Map});const f=t.get(x);f.count++,f.refs.has(b)||f.refs.set(b,{count:0,sermons:new Set}),f.refs.get(b).count++,f.refs.get(b).sermons.add(d.id)}}await new Promise(a=>setTimeout(a,10))}const s=Array.from(t.entries()).map(([o,r])=>({book:o,count:r.count,refs:Array.from(r.refs.entries()).map(([l,a])=>({ref:l,count:a.count,sermons:Array.from(a.sermons)})).sort((l,a)=>a.count-l.count).slice(0,10)})).sort((o,r)=>r.count-o.count);os(s)}catch(s){console.error("Scripture scan failed:",s)}jt(!1)},[oe,C,Le]),[J,De]=c.useState({date:"",venue:"",title:"",topic:""}),[de,Qe]=c.useState({key:"timestamp",direction:"desc"}),[fe,et]=c.useState(null),[wt,ds]=c.useState({x:0,y:0}),ms=c.useRef(null);c.useEffect(()=>{Qe(xe!==null?{key:"mentionCount",direction:"desc"}:{key:"timestamp",direction:"desc"})},[xe]),c.useEffect(()=>{const t=n=>{n.key==="Escape"&&ce&&B(null)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[ce]),c.useEffect(()=>{let t=!0;return(async()=>{try{const s="https://pub-faafa72c17d7419b88e9ee13181643b9.r2.dev/",o=[...s?[`${s}wmb_api/metadata.json`]:[],"wmb_api/metadata.json","/wmbmentions.github.io/wmb_api/metadata.json","https://raw.githubusercontent.com/messageanalytics/wmbmentions.github.io/main/docs/wmb_api/metadata.json"];let r=null,l="wmb_api/";for(const g of o)try{if(r=await fetch(g),r.ok){s&&g.startsWith(s)?l=`${s}wmb_api/`:l=g.includes("raw.githubusercontent")?"https://raw.githubusercontent.com/messageanalytics/wmbmentions.github.io/main/docs/wmb_api/":g.includes("/wmbmentions.github.io/")?"/wmbmentions.github.io/wmb_api/":"wmb_api/";break}}catch{}if(!r||!r.ok)throw new Error("WMB Metadata not found.");const a=await r.json();if(!t)return;const d=a.generated||"Unknown";At(d),v(a.totalChunks||0),Ke(a.totalSermons||0),zt(a.yearRange||""),Pt(a.totalWords||0),Ot(a.totalDurationMinutes||0),It(a.topicCounts||{}),Ft(a.venues||[]),w(l);const i=(a.sermons||[]).map(g=>{const j=g.duration&&g.duration>0?g.duration:null,b=g.wordCount/st/60,f=j?j/60:b>0?b:.5;return{...g,durationHrs:f,durationMinutes:j,mentionCount:0,mentionsPerHour:0}});P(i),ct([...new Set(i.map(g=>g.title))].filter(Boolean));const m=[...new Set(i.map(g=>g.year))].filter(g=>g!=="Unknown").sort();dt(m),mt([...new Set(i.map(g=>g.venue))].filter(Boolean));const x=[...new Set(i.flatMap(g=>g.topics||[]))];ht(x),X(!1)}catch(s){console.error("Failed to load WMB data:",s),t&&(Ae(s.message),X(!1))}})(),()=>{t=!1}},[]);const R=c.useMemo(()=>({titles:[...new Set(h.map(t=>t.title))].filter(Boolean).sort(),years:[...new Set(h.map(t=>t.year))].filter(t=>t!=="Unknown").sort(),venues:[...new Set(h.map(t=>t.venue))].filter(Boolean).sort(),topics:[...new Set(h.flatMap(t=>t.topics||[]))].sort()}),[h]),vt=c.useMemo(()=>xe===null?h:h.map(t=>{const n=xe.get(t.id)||0;return{...t,mentionCount:n,mentionsPerHour:t.durationHrs>0?parseFloat((n/t.durationHrs).toFixed(1)):0,searchTerm:le}}),[h,xe,le]),Nt=c.useMemo(()=>({titles:new Set(ve),years:new Set(Ne),venues:new Set(se),topics:new Set(Be)}),[ve,Ne,se,Be]),L=c.useMemo(()=>{const{titles:t,years:n,venues:s,topics:o}=Nt;return vt.filter(r=>{const l=!o.size||r.topics&&r.topics.some(a=>o.has(a));return t.has(r.title)&&n.has(r.year)&&s.has(r.venue)&&l})},[vt,Nt]),V=c.useMemo(()=>{if(!L.length)return null;const t=L.length,n=L.reduce((r,l)=>r+(l.mentionCount||0),0);let s=0,o=null;return L.forEach(r=>{(r.mentionCount||0)>s&&(s=r.mentionCount,o=r)}),{totalSermons:t,totalMentions:n,maxMentions:s,peakSermon:o,avg:t>0?(n/t).toFixed(1):"0",totalWords:L.reduce((r,l)=>r+(l.wordCount||0),0),totalDuration:L.reduce((r,l)=>r+(l.duration||0),0)}},[L]),tt=c.useMemo(()=>L.length?[...L].sort((n,s)=>n.timestamp-s.timestamp).map(n=>({timestamp:n.timestamp,mentionCount:n.mentionCount||0,title:n.title,...n})):[],[L]),me=c.useMemo(()=>{if(!tt.length)return[];const t=new Map;tt.forEach(o=>{const r=new Date(o.timestamp);r.setHours(0,0,0,0),r.setDate(r.getDate()-r.getDay());const l=r.getTime();t.has(l)||t.set(l,{timestamp:l,mentionCount:0,count:0,sermons:[]});const a=t.get(l);a.mentionCount+=o.mentionCount||0,a.count++,a.sermons.push(o)});const n=Array.from(t.values()).sort((o,r)=>o.timestamp-r.timestamp),s=Ye;return n.forEach((o,r)=>{const l=Math.max(0,r-s+1),a=n.slice(l,r+1),d=a.reduce((m,x)=>m+x.mentionCount,0)/a.length,i=a.reduce((m,x)=>m+x.count,0)/a.length;o.rollingAvg=parseFloat(d.toFixed(1)),o.volumeRollingAvg=parseFloat(i.toFixed(1))}),n},[tt,Ye]),hs=c.useMemo(()=>me.length?[me[0].timestamp,me[me.length-1].timestamp]:["auto","auto"],[me]),xs=t=>new Date(t).toLocaleDateString(void 0,{month:"short",year:"2-digit"}),ee=c.useMemo(()=>{if(!L.length)return[];const t=new Map;L.forEach(s=>{const o=s.venue||"Unknown";t.has(o)||t.set(o,{count:0,totalWords:0,years:new Set});const r=t.get(o);r.count++,r.totalWords+=s.wordCount||0,s.date&&r.years.add(s.date.slice(0,4))});const n=L.length;return Array.from(t.entries()).map(([s,o])=>{const r=Array.from(o.years).sort();return{venue:s,count:o.count,percent:(o.count/n*100).toFixed(1),totalWords:o.totalWords,dateRange:r.length>0?`${r[0]} - ${r[r.length-1]}`:"N/A"}}).sort((s,o)=>o.count-s.count)},[L]),K=c.useMemo(()=>{if(!h.length)return{venues:[],years:[],data:new Map,maxCount:0};const t=new Map,n=new Set,s=new Map;for(const a of h){const d=a.venue||"Unknown",i=a.year||"Unknown";n.add(i);const m=`${d}|${i}`;t.set(m,(t.get(m)||0)+1),s.set(d,(s.get(d)||0)+1)}const o=Array.from(s.entries()).sort((a,d)=>d[1]-a[1]).map(([a])=>a),r=Array.from(n).filter(a=>a!=="Unknown").sort();let l=0;for(const a of t.values())a>l&&(l=a);return{venues:o,years:r,data:t,maxCount:l,venueTotals:s}},[h]),Y=c.useMemo(()=>{if(!h.length)return{locations:[],years:[],data:new Map,maxCount:0};const t=new Map,n=new Set,s=new Map;for(const a of h){const d=a.location||"Unknown",i=a.year||"Unknown";n.add(i);const m=`${d}|${i}`;t.set(m,(t.get(m)||0)+1),s.set(d,(s.get(d)||0)+1)}const o=Array.from(s.entries()).sort((a,d)=>d[1]-a[1]).map(([a])=>a),r=Array.from(n).filter(a=>a!=="Unknown").sort();let l=0;for(const a of t.values())a>l&&(l=a);return{locations:o,years:r,data:t,maxCount:l,locationTotals:s}},[h]),us=c.useMemo(()=>{const t=new Map;return h.forEach(n=>{const s=n.year||"Unknown";t.has(s)||t.set(s,[]),t.get(s).push(n)}),Array.from(t.entries()).map(([n,s])=>({year:n,sermons:s.sort((o,r)=>(o.date||"").localeCompare(r.date||"")),count:s.length,totalWords:s.reduce((o,r)=>o+(r.wordCount||0),0)})).sort((n,s)=>s.year.localeCompare(n.year))},[h]),T=async(t,n,s=null,o={})=>{if(!t&&!s){We(null),ze(""),Pe(""),we([]);return}as(t||s),it.current={term:t,rawRegex:s,variations:n,...o},ue(!0),te({status:"Preparing search...",percent:0}),we([]),await gs(t,n,s,o)},gs=async(t,n,s=null,o={})=>{const{wholeWords:r=!0}=o;try{const a=Object.create(null),d=t&&Et(t)?t:s||t||"",i=Et(d);let m;if(i){const{type:p,required:D,excluded:Z,terms:re,distance:E,ordered:I,phrase:G}=i;if(p==="or"){const A=D.map(W=>he(W,r));m=W=>{for(const O of Z)if(he(O,r).test(W))return 0;let z=0;const _=[];for(let O=0;O<A.length;O++){A[O].lastIndex=0;const M=W.match(A[O]);if(M&&M.length>0){z+=M.length;for(const ye of M)_.push(ye.toLowerCase())}}return{count:z,matched:_}}}else if(p==="and"){const A=D.map(W=>he(W,r));m=W=>{for(const O of Z)if(he(O,r).test(W))return 0;let z=0;const _=[];for(let O=0;O<A.length;O++){A[O].lastIndex=0;const M=W.match(A[O]);if(!M||M.length===0)return 0;z+=M.length;for(const ye of M)_.push(ye.toLowerCase())}return{count:z,matched:_}}}else if(p==="phrase"){const A=r?new RegExp(`\\b(${G.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})\\b`,"gi"):new RegExp(`(${G.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");m=W=>{const z=W.match(A);return z?{count:z.length,matched:z.map(_=>_.toLowerCase())}:0}}else if(p==="near"||p==="onear"){const[A,W]=re,z=he(A,r),_=he(W,r);m=O=>{const M=O.split(/\s+/);let ye=0;const kt=[];for(let ne=0;ne<M.length;ne++)if(z.lastIndex=0,z.test(M[ne])){const ys=I?ne+1:Math.max(0,ne-E),js=Math.min(M.length,ne+E+1);for(let Ee=ys;Ee<js;Ee++)Ee!==ne&&(_.lastIndex=0,_.test(M[Ee])&&(ye++,kt.push(M[ne].toLowerCase(),M[Ee].toLowerCase())))}return{count:ye,matched:[...new Set(kt)]}}}else{const A=he(d,r);m=W=>{const z=W.match(A);return z?{count:z.length,matched:z.map(_=>_.toLowerCase())}:0}}}else if(s&&s.trim()){let p;try{p=r?new RegExp(`\\b(${s})\\b`,"gi"):new RegExp(`(${s})`,"gi")}catch(D){te({status:`Invalid regex: ${D.message}`,percent:0,error:!0}),ue(!1);return}m=D=>{p.lastIndex=0;const Z=D.match(p);return Z?{count:Z.length,matched:Z.map(re=>re.toLowerCase())}:0}}else{const p=E=>(""+E).replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let D=[t].filter(Boolean);if(n){const E=Array.isArray(n)?n:n.split(",").map(I=>I.trim()).filter(Boolean);D=[...D,...E.filter(Boolean)]}if(D.length===0){ue(!1);return}const Z=D.map(p).join("|"),re=r?new RegExp(`\\b(${Z})\\b`,"gi"):new RegExp(`(${Z})`,"gi");m=E=>{re.lastIndex=0;const I=E.match(re);return I?{count:I.length,matched:I.map(G=>G.toLowerCase())}:0}}const x=Object.create(null),g=oe||0;if(!g||g===0){te({status:"No data available",percent:0,error:!0}),ue(!1);return}te({status:"Searching transcripts...",percent:10});let j=0;for(let p=0;p<g;p+=50){const D=[];for(let E=p;E<Math.min(p+50,g);E++)D.push(fetch(`${C}text_chunk_${E}.json`).then(I=>I.ok?I.json():[]).catch(()=>[]));const Z=await Promise.all(D);for(const E of Z){for(const I of E)try{const G=m(I.text);if(G&&G.count>0&&(x[I.id]=(x[I.id]||0)+G.count,G.matched))for(const A of G.matched)a[A]=(a[A]||0)+1}catch{}j++}const re=Math.round(j/g*100);te({status:"Searching transcripts...",percent:10+Math.round(re*.85),detail:`${j} of ${g} chunks`}),await new Promise(E=>setTimeout(E,5))}te({status:"Counting matches...",percent:95});const b=new Map;for(const p in x)Object.hasOwn(x,p)&&b.set(p,x[p]);We(b),ze(t),Pe(s&&s.trim()?s:d);const f=[];for(const p in a)Object.hasOwn(a,p)&&f.push({term:p,count:a[p]});f.sort((p,D)=>D.count-p.count),we(f.slice(0,50)),ue(!1),te({status:"Done!",percent:100})}catch(l){console.error("Search failed",l),ue(!1),te({status:"Search failed",percent:0,error:!0})}},U=c.useMemo(()=>{let t=[...L];if(J.date&&(t=t.filter(n=>n.date.includes(J.date))),J.venue&&(t=t.filter(n=>n.venue&&n.venue.toLowerCase().includes(J.venue.toLowerCase()))),J.title&&(t=t.filter(n=>n.title.toLowerCase().includes(J.title.toLowerCase()))),J.search){const n=J.search.toLowerCase();t=t.filter(s=>(s.title||"").toLowerCase().includes(n)||(s.venue||"").toLowerCase().includes(n)||(s.location||"").toLowerCase().includes(n)||(s.date||"").toLowerCase().includes(n))}return de.key&&t.sort((n,s)=>{let o=n[de.key],r=s[de.key];return typeof o=="string"&&(o=o.toLowerCase()),typeof r=="string"&&(r=r.toLowerCase()),o<r?de.direction==="asc"?-1:1:o>r?de.direction==="asc"?1:-1:0}),t},[L,J,de]),ps=c.useCallback(()=>{if(!U||U.length===0){alert("No results to export");return}const t=["Date","Title","Venue","Words","Matches","Duration (min)"],n=U.map(a=>[a.date||"",`"${(a.title||"").replace(/"/g,'""')}"`,`"${(a.venue||"").replace(/"/g,'""')}"`,a.wordCount||0,a.mentionCount||0,Math.round((a.wordCount||0)/st)]),s=[t.join(","),...n.map(a=>a.join(","))].join(`
`),o=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download=`wmb_search_results_${(y||"all").replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}.csv`,l.click(),URL.revokeObjectURL(r)},[U,y]),bs=()=>{ke(R.titles),ie(R.years),Ce(R.venues),xt(R.topics)},fs=ve.length!==R.titles.length||Ne.length!==R.years.length||se.length!==R.venues.length||Be.length!==R.topics.length;return F?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-amber-50 to-orange-100",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-2xl shadow-xl border border-amber-200 max-w-md w-full mx-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-amber-200 border-t-amber-600 rounded-full animate-spin mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-amber-800 mb-2",children:"Loading Branham Archive"}),e.jsx("p",{className:"text-amber-600 text-sm",children:"1,181 sermons â€¢ 17.5M words â€¢ 1947-1965"})]})}):Q?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-red-50 p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-xl border border-red-200 max-w-lg w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Failed to Load"}),e.jsx("p",{className:"text-gray-600 mb-4",children:Q}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white font-bold py-2 px-6 rounded hover:bg-red-700 transition",children:"Retry"})]})}):e.jsx(Ls,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-700 to-orange-600 text-white shadow-lg sticky top-0 z-40",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"bg-white/20 backdrop-blur p-2 rounded-lg shadow-lg flex-shrink-0",children:e.jsx(u,{name:"book",className:"text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"font-bold text-base md:text-lg text-white leading-tight truncate",children:"William Branham Sermon Archive"}),e.jsxs("p",{className:"text-xs text-amber-100 truncate",children:[rt," â€¢ ",N.toLocaleString()," sermons â€¢ ",(nt/1e6).toFixed(1),"M words"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3 md:gap-4 w-full md:w-auto",children:[at&&e.jsxs("div",{className:"text-xs text-amber-200 text-center md:text-right",children:["Data: ",at]}),e.jsx("div",{className:"flex bg-white/10 backdrop-blur p-1 rounded-lg w-full md:w-auto",children:[{key:"dashboard",label:"Search & Stats"},{key:"data",label:"Sources"},{key:"about",label:"About"}].map(t=>e.jsx("button",{onClick:()=>Vt(t.key),className:`px-3 md:px-4 py-1.5 rounded-md text-xs md:text-sm font-medium transition flex-1 md:flex-none ${Se===t.key?"bg-white text-amber-700 shadow-sm":"text-amber-100 hover:text-white hover:bg-white/10"}`,children:t.label},t.key))}),k&&e.jsx("button",{onClick:k,className:"px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded-md text-xs font-medium text-amber-100 hover:text-white transition",children:"â† Back to Main"})]})]})}),e.jsxs("div",{className:"bg-amber-100 border-b border-amber-200 text-amber-800 text-xs text-center py-2 px-4",children:[e.jsx("span",{className:"font-bold",children:"Source:"})," Transcripts from ",e.jsx("a",{href:"https://www.livingwordbroadcast.org/wbtextindex",target:"_blank",rel:"noopener noreferrer",className:"text-amber-700 hover:text-amber-900 underline",children:"Living Word Broadcast"})," â€¢ Click any sermon to read the full transcript â€¢ ",e.jsx("kbd",{className:"px-1 py-0.5 bg-amber-200 rounded text-xs",children:"âŒ˜K"})," to search"]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[Se==="dashboard"&&e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-3",children:[e.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2 text-sm",children:[e.jsx(u,{name:"filter",size:16})," Filters"]}),e.jsx("div",{className:"flex items-center gap-2",children:fs&&e.jsx("button",{onClick:bs,className:"text-xs text-amber-600 hover:text-amber-800 font-medium",children:"Clear all filters"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(_e,{label:"Years",options:R.years,selected:Ne,onChange:ie}),e.jsx(_e,{label:"Venues",options:R.venues,selected:se,onChange:Ce}),e.jsx(_e,{label:"Topics",options:R.topics,selected:Be,onChange:xt}),e.jsx(_e,{label:"Titles",options:R.titles,selected:ve,onChange:ke})]}),Object.keys(pe).length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 flex items-center gap-1 mb-2",children:[e.jsx(u,{name:"clock",size:14,className:"text-blue-500"})," Continue Reading"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(pe).sort((t,n)=>n[1].timestamp-t[1].timestamp).slice(0,5).map(([t,n])=>{const s=h.find(o=>o.id===t);return s?e.jsxs("button",{onClick:()=>{B({...s,resumePosition:n.position}),H(0)},className:"px-2 py-1 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded text-xs text-blue-800 flex items-center gap-1 max-w-xs",children:[e.jsx(u,{name:"arrowRight",size:12}),e.jsx("span",{className:"truncate",children:s.title}),e.jsxs("span",{className:"text-blue-500",children:["(",Math.round(n.position*100),"%)"]})]},t):null})})]})]}),Se==="dashboard"&&V&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm mb-6",children:[e.jsxs("button",{onClick:()=>Zt(!ae),className:`w-full flex items-center justify-between p-4 transition-colors ${ae?"bg-gradient-to-r from-amber-50 to-orange-50 hover:from-amber-100 hover:to-orange-100":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{name:ae?"chevronRight":"chevronDown",size:18,className:ae?"text-amber-600":"text-gray-500"}),e.jsxs("h3",{className:`font-bold ${ae?"text-amber-800":"text-gray-800"}`,children:[e.jsx(u,{name:"barChart",className:"inline mr-1",size:16})," Sermons by Venue"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",ee.length," venues)"]})]}),e.jsx("span",{className:`text-sm font-medium ${ae?"text-amber-600 bg-amber-100 px-3 py-1 rounded-full":"text-xs text-gray-400"}`,children:ae?"â–¶ Click to view":"Click to collapse"})]}),!ae&&e.jsxs("div",{className:"p-4 pt-2",children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:()=>Ze("bars"),className:`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${ge==="bars"?"bg-amber-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“Š Bar Chart"}),e.jsx("button",{onClick:()=>Ze("heatmap"),className:`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${ge==="heatmap"?"bg-amber-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ—“ï¸ Venue Ã— Year"}),e.jsx("button",{onClick:()=>Ze("location"),className:`px-3 py-1.5 text-sm font-medium rounded-lg transition-colors ${ge==="location"?"bg-amber-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"ðŸ“ Location Ã— Year"})]}),ge==="bars"&&ee.length>0&&(()=>{const t=Math.max(...ee.map(o=>o.count)),n=Math.ceil(t/50)*50,s=[];for(let o=0;o<=n;o+=50)s.push(o);return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Click a bar to filter sermons by that venue. Darker bars = more sermons."}),e.jsx("div",{style:{height:Math.max(400,ee.length*20)},children:e.jsx(Ct,{width:"100%",height:"100%",children:e.jsxs(vs,{data:ee,layout:"vertical",margin:{top:10,right:30,left:5,bottom:5},barSize:14,children:[e.jsx(St,{strokeDasharray:"3 3",horizontal:!1}),e.jsx($t,{type:"number",tickFormatter:o=>o.toLocaleString(),orientation:"top",axisLine:!1,tickLine:!1,tick:{fontSize:10},ticks:s,domain:[0,n]}),e.jsx(Tt,{type:"category",dataKey:"venue",width:typeof window<"u"&&window.innerWidth<640?160:280,tick:{fontSize:typeof window<"u"&&window.innerWidth<640?9:11},interval:0}),e.jsx(Mt,{content:({active:o,payload:r})=>{if(!o||!r||!r.length)return null;const l=r[0].payload;return e.jsxs("div",{className:"bg-white border rounded-lg shadow-lg p-3 text-sm max-w-xs",children:[e.jsx("p",{className:"font-bold text-gray-800 mb-2",children:l.venue}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-amber-600",children:["ðŸ“Š Sermons: ",e.jsx("span",{className:"font-semibold",children:l.count.toLocaleString()})," ",e.jsxs("span",{className:"text-gray-400",children:["(",l.percent,"%)"]})]}),e.jsxs("p",{className:"text-gray-600",children:["ðŸ“… Years: ",l.dateRange]}),e.jsxs("p",{className:"text-blue-600",children:["ðŸ“ Words: ",e.jsx("span",{className:"font-semibold",children:l.totalWords.toLocaleString()})]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2 italic",children:"Click to browse sermons"})]})}}),e.jsx(Ns,{dataKey:"count",radius:[0,4,4,0],children:ee.map((o,r)=>{const l=1-r/(ee.length-1||1),a=Math.round(254+-74*l),d=Math.round(243+-160*l),i=Math.round(199+-190*l),m=`rgb(${a},${d},${i})`,x=$e===o.venue;return e.jsx(ks,{fill:x?"#d97706":m,stroke:x?"#92400e":"none",strokeWidth:x?2:0,style:{cursor:"pointer"},onClick:()=>Ie(o.venue)},o.venue)})})]})})})]})})(),ge==="heatmap"&&K&&e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Sermon distribution by venue and year. Darker = more sermons. Click to filter."}),e.jsxs("div",{className:"grid border border-gray-300 rounded overflow-hidden",style:{gridTemplateColumns:`280px repeat(${K.years.length}, minmax(32px, 1fr)) 50px`,minWidth:`${280+K.years.length*36+50}px`},children:[e.jsx("div",{className:"bg-gray-100 p-1.5 text-xs font-bold text-gray-700 sticky left-0 z-10 border-b border-r border-gray-300",children:"Venue"}),K.years.map(t=>e.jsx("div",{className:"bg-gray-100 p-1.5 text-xs font-bold text-gray-700 text-center border-b border-r border-gray-300",children:t.toString().slice(-2)},t)),e.jsx("div",{className:"bg-gray-100 p-1.5 text-xs font-bold text-gray-700 text-center border-b border-gray-300",children:"Total"}),K.venues.map((t,n)=>e.jsxs(Rt.Fragment,{children:[e.jsx("div",{className:`bg-white p-1.5 text-xs truncate sticky left-0 z-10 cursor-pointer hover:bg-amber-50 border-b border-r border-gray-200 ${se.includes(t)?"bg-amber-100 font-semibold":""}`,title:`${t} (${K.venueTotals.get(t)||0} sermons)`,onClick:()=>{se.includes(t)?Ce(se.filter(s=>s!==t)):Ce([...se,t])},children:t}),K.years.map(s=>{const o=K.data.get(`${t}|${s}`)||0,r=o>0?Math.min(.15+o/K.maxCount*.85,1):0;return e.jsx("div",{className:"p-1.5 text-center text-xs cursor-pointer transition-colors hover:ring-1 hover:ring-amber-400 border-b border-r border-gray-200",style:{backgroundColor:o>0?`rgba(217, 119, 6, ${r})`:"white",color:r>.5?"white":o>0?"#92400e":"#9ca3af"},title:`${t} (${s}): ${o} sermon${o!==1?"s":""}`,onClick:()=>{Ce([t]),ie([s.toString()])},children:o>0?o:"Â·"},`${t}-${s}`)}),e.jsx("div",{className:"p-1.5 text-center text-xs font-semibold bg-gray-50 border-b border-gray-200 text-gray-700",title:`${t}: ${K.venueTotals.get(t)||0} total sermons`,children:K.venueTotals.get(t)||0})]},t))]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 text-xs text-gray-500",children:[e.jsx("span",{children:"Fewer"}),e.jsx("div",{className:"flex",children:[.15,.35,.55,.75,.95].map((t,n)=>e.jsx("div",{className:"w-5 h-4",style:{backgroundColor:`rgba(217, 119, 6, ${t})`}},n))}),e.jsx("span",{children:"More sermons"})]})]}),ge==="location"&&Y&&e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Sermon distribution by location (city) and year. Darker = more sermons. Click to filter."}),e.jsxs("div",{className:"grid border border-gray-300 rounded overflow-hidden",style:{gridTemplateColumns:`200px repeat(${Y.years.length}, minmax(32px, 1fr)) 50px`,minWidth:`${200+Y.years.length*36+50}px`},children:[e.jsx("div",{className:"bg-gray-100 p-1.5 text-xs font-bold text-gray-700 sticky left-0 z-10 border-b border-r border-gray-300",children:"Location"}),Y.years.map(t=>e.jsx("div",{className:"bg-gray-100 p-1.5 text-xs font-bold text-gray-700 text-center border-b border-r border-gray-300",children:t.toString().slice(-2)},t)),e.jsx("div",{className:"bg-gray-100 p-1.5 text-xs font-bold text-gray-700 text-center border-b border-gray-300",children:"Total"}),Y.locations.map((t,n)=>e.jsxs(Rt.Fragment,{children:[e.jsx("div",{className:"bg-white p-1.5 text-xs truncate sticky left-0 z-10 cursor-pointer hover:bg-amber-50 border-b border-r border-gray-200",title:`${t} (${Y.locationTotals.get(t)||0} sermons)`,onClick:()=>{De(s=>({...s,search:t}))},children:t}),Y.years.map(s=>{const o=Y.data.get(`${t}|${s}`)||0,r=o>0?Math.min(.15+o/Y.maxCount*.85,1):0;return e.jsx("div",{className:"p-1.5 text-center text-xs cursor-pointer transition-colors hover:ring-1 hover:ring-amber-400 border-b border-r border-gray-200",style:{backgroundColor:o>0?`rgba(16, 185, 129, ${r})`:"white",color:r>.5?"white":o>0?"#065f46":"#9ca3af"},title:`${t} (${s}): ${o} sermon${o!==1?"s":""}`,onClick:()=>{De(l=>({...l,search:t})),ie([s.toString()])},children:o>0?o:"Â·"},`${t}-${s}`)}),e.jsx("div",{className:"p-1.5 text-center text-xs font-semibold bg-gray-50 border-b border-gray-200 text-gray-700",title:`${t}: ${Y.locationTotals.get(t)||0} total sermons`,children:Y.locationTotals.get(t)||0})]},t))]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 text-xs text-gray-500",children:[e.jsx("span",{children:"Fewer"}),e.jsx("div",{className:"flex",children:[.15,.35,.55,.75,.95].map((t,n)=>e.jsx("div",{className:"w-5 h-4",style:{backgroundColor:`rgba(16, 185, 129, ${t})`}},n))}),e.jsx("span",{children:"More sermons"})]})]})]})]}),Ue.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Recent:"}),Ue.slice(0,8).map((t,n)=>e.jsx("button",{onClick:()=>{$(t.term),T(t.term,"",null,{wholeWords:!0})},className:"px-2 py-0.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded text-xs transition",children:t.term.length>20?t.term.slice(0,20)+"...":t.term},n)),e.jsx("button",{onClick:()=>{confirm("Clear search history?")&&yt([])},className:"text-xs text-gray-400 hover:text-red-500",children:"âœ•"})]}),e.jsx(Cs,{onAnalyze:T,isAnalyzing:lt,progress:Jt,initialTerm:"",initialVariations:"",matchedTerms:Ht,totalTranscripts:N,defaultTerm:"",defaultRegex:"",externalTerm:Ut}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium self-center mr-2",children:"Featured Series:"}),e.jsxs("button",{onClick:()=>{const t=["63-0317E","63-0318","63-0319","63-0320","63-0321","63-0322","63-0323","63-0324E"],n=h.filter(s=>t.some(o=>s.dateCode===o||s.id?.startsWith(o))).map(s=>s.title);n.length>0&&(ke(n),ie(["1963"]))},className:"px-3 py-1.5 bg-amber-100 hover:bg-amber-200 text-amber-800 rounded-lg text-sm font-medium transition flex items-center gap-1.5",children:[e.jsx(u,{name:"book",size:14})," The Seven Seals"]}),e.jsxs("button",{onClick:()=>{const t=["60-1205","60-1206","60-1207","60-1208","60-1209","60-1210","60-1211E"],n=h.filter(s=>t.some(o=>s.dateCode===o||s.id?.startsWith(o))).map(s=>s.title);n.length>0&&(ke(n),ie(["1960"]))},className:"px-3 py-1.5 bg-indigo-100 hover:bg-indigo-200 text-indigo-800 rounded-lg text-sm font-medium transition flex items-center gap-1.5",children:[e.jsx(u,{name:"book",size:14})," The Seven Church Ages"]}),(ve.length!==R.titles.length||Ne.length!==R.years.length)&&e.jsxs("button",{onClick:()=>{ke(R.titles),ie(R.years)},className:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm font-medium transition flex items-center gap-1.5",children:[e.jsx(u,{name:"x",size:14})," Show All Sermons"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium self-center mr-2",children:"Hot Topics:"}),e.jsxs("button",{onClick:()=>{$('"THUS SAITH THE LORD"'),T('"THUS SAITH THE LORD"',"",null,{wholeWords:!0})},className:"px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg text-sm font-medium transition flex items-center gap-1.5",children:[e.jsx(u,{name:"search",size:14}),' "THUS SAITH THE LORD"']}),e.jsx("button",{onClick:()=>{$("faith"),T("faith","",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-purple-100 hover:bg-purple-200 text-purple-800 rounded-lg text-xs font-medium transition",children:"Faith"}),e.jsx("button",{onClick:()=>{$("angel"),T("angel","",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg text-xs font-medium transition",children:"Angel"}),e.jsx("button",{onClick:()=>{$('"Holy Ghost" OR "Holy Spirit"'),T('"Holy Ghost" OR "Holy Spirit"',"",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-sky-100 hover:bg-sky-200 text-sky-800 rounded-lg text-xs font-medium transition",children:"Holy Ghost"}),e.jsx("button",{onClick:()=>{$('"divine healing" OR healed OR healing'),T('"divine healing" OR healed OR healing',"",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-green-100 hover:bg-green-200 text-green-800 rounded-lg text-xs font-medium transition",children:"Divine Healing"}),e.jsx("button",{onClick:()=>{$("prophet"),T("prophet","",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-orange-100 hover:bg-orange-200 text-orange-800 rounded-lg text-xs font-medium transition",children:"Prophet"}),e.jsx("button",{onClick:()=>{$('"end time" OR "last days"'),T('"end time" OR "last days"',"",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-rose-100 hover:bg-rose-200 text-rose-800 rounded-lg text-xs font-medium transition",children:"End Time"}),e.jsx("button",{onClick:()=>{$("baptism OR baptized OR baptize"),T("baptism OR baptized OR baptize","",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-cyan-100 hover:bg-cyan-200 text-cyan-800 rounded-lg text-xs font-medium transition",children:"Baptism"}),e.jsx("button",{onClick:()=>{$("bride"),T("bride","",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-pink-100 hover:bg-pink-200 text-pink-800 rounded-lg text-xs font-medium transition",children:"Bride"}),e.jsx("button",{onClick:()=>{$(`"serpent's seed" OR "serpent seed"`),T(`"serpent's seed" OR "serpent seed"`,"",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-lime-100 hover:bg-lime-200 text-lime-800 rounded-lg text-xs font-medium transition",children:"Serpent's Seed"}),e.jsx("button",{onClick:()=>{$('godhead OR trinity OR "oneness"'),T('godhead OR trinity OR "oneness"',"",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-violet-100 hover:bg-violet-200 text-violet-800 rounded-lg text-xs font-medium transition",children:"Godhead"}),e.jsx("button",{onClick:()=>{$("rapture"),T("rapture","",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-fuchsia-100 hover:bg-fuchsia-200 text-fuchsia-800 rounded-lg text-xs font-medium transition",children:"Rapture"}),e.jsx("button",{onClick:()=>{$('"third pull"'),T('"third pull"',"",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-teal-100 hover:bg-teal-200 text-teal-800 rounded-lg text-xs font-medium transition",children:"Third Pull"}),e.jsx("button",{onClick:()=>{$('"seven thunders"'),T('"seven thunders"',"",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-800 rounded-lg text-xs font-medium transition",children:"Seven Thunders"}),e.jsx("button",{onClick:()=>{$("revelation OR revelations"),T("revelation OR revelations","",null,{wholeWords:!0})},className:"px-2.5 py-1 bg-emerald-100 hover:bg-emerald-200 text-emerald-800 rounded-lg text-xs font-medium transition",children:"Revelation"}),y&&e.jsxs("button",{onClick:()=>{ze(""),Pe(""),We(null),we([]),$("")},className:"px-2.5 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-xs font-medium transition flex items-center gap-1",children:[e.jsx(u,{name:"x",size:12})," Clear Search"]})]}),xe&&V.totalMentions===0&&!lt&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6 flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center",children:e.jsx(u,{name:"alertCircle",size:20,className:"text-amber-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-amber-800 text-sm",children:"No Results Found"}),e.jsxs("p",{className:"text-amber-700 text-xs mt-1",children:['Your search for "',e.jsx("span",{className:"font-semibold",children:y}),'" did not match any transcripts.']})]})]}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-1.5 sm:gap-2 mb-6",children:[e.jsx(je,{title:"Sermons",value:V.totalSermons.toLocaleString(),icon:"book",color:"amber",sub:`of ${N.toLocaleString()} total`}),y&&e.jsx(je,{title:`"${y}" Matches`,value:V.totalMentions.toLocaleString(),icon:"search",color:V.totalMentions===0?"red":"green",sub:"in filtered results"}),e.jsx(je,{title:"Total Words",value:`${(V.totalWords/1e6).toFixed(1)}M`,icon:"fileText",color:"blue",sub:"in filtered sermons"}),e.jsx(je,{title:"Total Hours",value:Math.round(V.totalDuration/60).toLocaleString(),icon:"clock",color:"purple",sub:"of preaching"}),y&&e.jsx(je,{title:"Avg Mentions",value:V.avg,icon:"barChart",color:"indigo",sub:"per sermon (filtered)"}),V.peakSermon&&y&&e.jsx(je,{title:"Peak Count",value:V.maxMentions,icon:"activity",color:"orange",sub:"Click to view transcript mentions",onClick:()=>{B({...V.peakSermon,searchTerm:le||y}),H(0)}})]}),e.jsxs("div",{className:"bg-white p-3 sm:p-6 rounded-xl border shadow-sm h-[350px] sm:h-[450px] mb-6 relative",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(u,{name:"activity"})," Sermon Timeline (1947-1965)"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[y?`Showing "${y}" mentions over time`:"Sermon distribution over time"," â€¢ Click a point to browse"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[y&&e.jsxs("button",{onClick:()=>{ze(""),Pe(""),We(null),we([])},className:"text-xs bg-red-100 text-red-700 hover:bg-red-200 px-3 py-1.5 rounded-lg font-medium flex items-center gap-1 transition-colors",children:[e.jsx(u,{name:"x",size:12})," Clear Search"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Smoothing:"}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[{w:4,l:"1 Mo"},{w:12,l:"3 Mo"},{w:26,l:"6 Mo"}].map(({w:t,l:n})=>e.jsx("button",{onClick:()=>_t(t),className:`px-2 py-1 text-xs font-medium rounded ${Ye===t?"bg-white shadow text-amber-600":"text-gray-500"}`,children:n},t))})]})]}),e.jsx(Ct,{width:"100%",height:"85%",children:e.jsxs(Ss,{data:me,onClick:(t,n,s)=>{if(t&&t.activePayload&&t.activePayload[0]){const o=me.find(r=>r.timestamp===t.activePayload[0].payload.timestamp);if(o){const r=s?.clientX||t.chartX+100,l=s?.clientY||t.chartY+200;et(o),ds({x:r,y:l})}}},children:[e.jsx(St,{strokeDasharray:"3 3",vertical:!1,stroke:"#e5e7eb"}),e.jsx($t,{dataKey:"timestamp",type:"number",scale:"time",domain:hs,tickFormatter:xs,tick:{fontSize:10},minTickGap:80}),e.jsx(Tt,{tick:{fontSize:10},label:{value:y?"Mentions":"Sermons",angle:-90,position:"insideLeft",style:{textAnchor:"middle",fontSize:11,fill:"#6b7280"}}}),e.jsx(Mt,{content:({active:t,payload:n})=>{if(fe||!t||!n||!n.length)return null;const s=n[0].payload,o=`Week of ${new Date(s.timestamp).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}`;return e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-lg text-sm border border-gray-200",children:[e.jsx("div",{className:"font-bold text-gray-900",children:o}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[y?e.jsxs(e.Fragment,{children:[s.mentionCount," mentions â€¢ "]}):null,s.count," sermon",s.count!==1?"s":""]}),e.jsx("div",{className:"mt-2 text-amber-600 text-xs font-medium",children:"Click to browse â†’"})]})}}),e.jsx($s,{wrapperStyle:{fontSize:"11px",paddingTop:"8px"}}),y?e.jsxs(e.Fragment,{children:[e.jsx(Lt,{type:"monotone",dataKey:"mentionCount",name:"Mentions",stroke:"#f59e0b",fill:"#fcd34d",fillOpacity:.6,isAnimationActive:!1,cursor:"pointer"}),e.jsx(Dt,{type:"monotone",dataKey:"rollingAvg",name:"Trend",stroke:"#d97706",strokeWidth:3,dot:!1,isAnimationActive:!1})]}):e.jsxs(e.Fragment,{children:[e.jsx(Lt,{type:"monotone",dataKey:"count",name:"Sermons",stroke:"#f59e0b",fill:"#fcd34d",fillOpacity:.6,isAnimationActive:!1,cursor:"pointer"}),e.jsx(Dt,{type:"monotone",dataKey:"volumeRollingAvg",name:"Trend",stroke:"#d97706",strokeWidth:3,dot:!1,isAnimationActive:!1})]})]})}),fe&&e.jsxs("div",{ref:ms,className:"fixed bg-white rounded-xl shadow-2xl border border-gray-200 w-[calc(100%-16px)] sm:w-96 max-h-[60vh] sm:max-h-[400px] flex flex-col z-50",style:{left:typeof window<"u"?Math.min(Math.max(20,wt.x+15),window.innerWidth-420):20,top:typeof window<"u"?Math.min(Math.max(20,wt.y-50),window.innerHeight-450):100},children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-900",children:["Week of ",new Date(fe.timestamp).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[fe.sermons?.length||0," sermon",(fe.sermons?.length||0)!==1?"s":""]})]}),e.jsx("button",{onClick:()=>et(null),className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(u,{name:"x"})})]})}),e.jsx("div",{className:"text-xs font-medium text-gray-600 px-3 pt-2 pb-1",children:"Click a sermon to view transcript:"}),e.jsx("div",{className:"flex-1 overflow-auto px-2 pb-2",children:e.jsx("div",{className:"space-y-1",children:[...fe.sermons||[]].sort((t,n)=>(n.mentionCount||0)-(t.mentionCount||0)).map((t,n)=>e.jsxs("button",{onClick:()=>{B({...t,searchTerm:le||y}),H(0),et(null)},className:"w-full text-left px-2 py-1.5 bg-amber-50 rounded border border-amber-200 hover:bg-amber-100 hover:border-amber-300 transition-all group",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 group-hover:text-amber-700 line-clamp-1",children:t.title||"Untitled"}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsx("span",{className:"truncate max-w-[140px]",children:t.venue||"Unknown"}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[y&&t.mentionCount>0&&e.jsx("span",{className:"text-amber-600 font-medium",children:t.mentionCount}),e.jsx("span",{className:"text-gray-400",children:new Date(t.timestamp).toLocaleDateString()})]})]})]},t.id||n))})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm mb-8 p-4 sm:p-6 overflow-x-auto w-full",children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("h3",{className:"font-bold text-gray-800",children:["Sermon Search Results (",U.length.toLocaleString(),")"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[y&&e.jsxs("div",{className:"text-sm bg-amber-50 text-amber-700 px-3 py-1 rounded font-medium",children:["Searching for: ",e.jsx("span",{className:"font-semibold",children:y})]}),e.jsxs("button",{onClick:()=>be(U,`WMB_All_Transcripts_${U.length}.zip`,`${U.length} sermons`),disabled:S!==null||U.length===0,className:"text-xs bg-amber-500 text-white hover:bg-amber-600 px-3 py-1.5 rounded font-medium flex items-center gap-1 disabled:opacity-50",title:`Download all ${U.length} transcripts as ZIP`,children:[e.jsx(u,{name:"download",size:12})," Download All (",U.length,")"]}),e.jsxs("button",{onClick:ps,className:"text-xs bg-green-100 text-green-700 hover:bg-green-200 px-3 py-1.5 rounded font-medium flex items-center gap-1",title:"Export search results as CSV",children:[e.jsx(u,{name:"download",size:12})," Export CSV"]}),e.jsxs("a",{href:"https://www.livingwordbroadcast.org/wbtextindex",target:"_blank",rel:"noopener noreferrer",className:"text-xs bg-amber-100 text-amber-700 hover:bg-amber-200 px-3 py-1.5 rounded font-medium flex items-center gap-1",children:[e.jsx(u,{name:"externalLink",size:12})," Browse LWB Transcripts"]})]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(u,{name:"search",size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search table by title, venue, date...",value:J.search||"",onChange:t=>De(n=>({...n,search:t.target.value})),className:"w-full pl-9 pr-8 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent","data-search-input":!0}),J.search&&e.jsx("button",{onClick:()=>De(t=>({...t,search:""})),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(u,{name:"x",size:14})})]})]}),e.jsx(Ts,{columns:[{key:"date",label:"Date",width:"100px",filterKey:"date",filterPlaceholder:"YYYY",render:t=>t.date},{key:"title",label:"Title",width:"1fr",filterKey:"title",render:t=>e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate block",title:t.title,children:t.title})})},{key:"venue",label:"Venue",width:"200px",filterKey:"venue",hideOnMobile:!0,render:t=>e.jsx("span",{className:"text-xs text-gray-600 truncate",children:t.venue||"â€”"})},{key:"location",label:"Location",width:"140px",hideOnMobile:!0,render:t=>e.jsx("span",{className:"text-xs text-gray-500",children:t.location||"â€”"})},...y?[{key:"mentionCount",label:"Mentions",width:"80px",render:t=>e.jsx("span",{className:`text-xs font-bold ${t.mentionCount>0?"text-amber-600":"text-gray-400"}`,children:t.mentionCount||0})}]:[],{key:"readTime",label:"Read Time",width:"75px",hideOnMobile:!0,render:t=>{const n=Math.round((t.wordCount||0)/st);return e.jsx("span",{className:"text-xs text-gray-500",children:n>60?`${Math.round(n/60)}h ${n%60}m`:`${n}m`})}},{key:"wordCount",label:"Words",width:"90px",hideOnMobile:!0,render:t=>e.jsx("span",{className:"text-xs text-gray-500",children:t.wordCount?.toLocaleString()||"â€”"})},{key:"download",label:"Download",width:"90px",render:t=>t.path?e.jsxs("a",{href:`/analytics/${Ve(t.path)}`,download:!0,onClick:s=>s.stopPropagation(),className:"text-xs text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1",children:[e.jsx(u,{name:"download",size:12})," TXT"]}):"â€”"}],data:U,filters:J,onFilterChange:(t,n)=>De(s=>({...s,[t]:n})),sortConfig:de,onSort:t=>Qe(n=>({key:t,direction:n.key===t&&n.direction==="asc"?"desc":"asc"})),onRowClick:t=>{B({...t,searchTerm:le||y}),H(0)},rowHeight:48})]}),e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Archive Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-amber-700",children:N.toLocaleString()}),e.jsx("div",{className:"text-sm text-amber-600",children:"Total Sermons"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-700",children:[(nt/1e6).toFixed(1),"M"]}),e.jsx("div",{className:"text-sm text-blue-600",children:"Total Words"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-700",children:Math.round(Wt/60).toLocaleString()}),e.jsx("div",{className:"text-sm text-purple-600",children:"Hours of Preaching"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-green-700",children:ot.length}),e.jsx("div",{className:"text-sm text-green-600",children:"Unique Venues"})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-bold text-indigo-800 flex items-center gap-2",children:[e.jsx(u,{name:"book",size:18})," Scripture References"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[q&&e.jsxs("div",{className:"flex bg-white rounded-lg border overflow-hidden",children:[e.jsx("button",{onClick:()=>Ge("grid"),className:`px-3 py-1.5 text-sm font-medium transition-colors ${Fe==="grid"?"bg-indigo-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:"Grid"}),e.jsx("button",{onClick:()=>Ge("heatmap"),className:`px-3 py-1.5 text-sm font-medium transition-colors ${Fe==="heatmap"?"bg-indigo-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:"Heatmap"})]}),!q&&e.jsx("button",{onClick:cs,disabled:Le,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2",children:Le?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"})," Scanning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{name:"search",size:14})," Scan Transcripts"]})})]})]}),!q&&!Le&&e.jsx("p",{className:"text-sm text-indigo-600",children:'Click "Scan Transcripts" to find all Bible references mentioned across the archive. This may take a few minutes.'}),q&&Fe==="grid"&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-indigo-600 mb-3",children:["Found references to ",q.length," books of the Bible"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 max-h-64 overflow-y-auto",children:q.slice(0,24).map(({book:t,count:n,refs:s})=>{const o=He.has(`scripture-${t}`);return e.jsxs("div",{className:"bg-white rounded border overflow-hidden",children:[e.jsxs("button",{onClick:()=>Te(r=>{const l=new Set(r),a=`scripture-${t}`;return l.has(a)?l.delete(a):l.add(a),l}),className:`w-full p-2 flex justify-between items-center text-sm ${o?"bg-indigo-100":"hover:bg-gray-50"}`,children:[e.jsx("span",{className:"font-medium text-gray-800 truncate",children:t}),e.jsx("span",{className:"text-xs text-indigo-600 ml-1",children:n.toLocaleString()})]}),o&&e.jsx("div",{className:"border-t p-2 text-xs space-y-1 max-h-40 overflow-y-auto bg-gray-50",children:s.map(({ref:r,count:l})=>e.jsxs("button",{onClick:()=>{$(r),T(r,"",null,{wholeWords:!1})},className:"w-full text-left px-2 py-1 hover:bg-indigo-100 rounded flex justify-between",children:[e.jsx("span",{className:"truncate",children:r}),e.jsxs("span",{className:"text-indigo-500 ml-1",children:["(",l,")"]})]},r))})]},t)})})]}),q&&Fe==="heatmap"&&(()=>{const t=["Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth","1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra","Nehemiah","Esther","Job","Psalms","Proverbs","Ecclesiastes","Song of Solomon","Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel","Hosea","Joel","Amos","Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah","Malachi"],n=["Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians","Galatians","Ephesians","Philippians","Colossians","1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon","Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"],s=Math.max(...q.map(l=>l.count)),o=new Map(q.map(l=>[l.book,l])),r=(l,a)=>l.filter(i=>o.has(i)).length===0?null:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-bold text-indigo-700 mb-2",children:a}),e.jsx("div",{className:"flex flex-wrap gap-1",children:l.map(i=>{const m=o.get(i),x=m?.count||0,g=x>0?Math.min(.15+x/s*.85,1):0;return e.jsx("button",{onClick:()=>{m&&(Te(j=>{const b=new Set(j),f=`scripture-${i}`;return b.has(f)?b.delete(f):b.add(f),b}),Ge("grid"))},className:`px-2 py-1 rounded text-xs font-medium transition-colors ${x>0?"cursor-pointer hover:ring-1 hover:ring-indigo-400":"cursor-default opacity-30"}`,style:{backgroundColor:x>0?`rgba(79, 70, 229, ${g})`:"#e5e7eb",color:g>.5?"white":x>0?"#3730a3":"#9ca3af"},title:x>0?`${i}: ${x.toLocaleString()} references`:`${i}: No references found`,children:i.length>10?i.slice(0,8)+"...":i},i)})})]},a);return e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-indigo-600 mb-3",children:["Found references to ",q.length," books of the Bible. Click a book to see specific verses."]}),r(t,"Old Testament"),r(n,"New Testament"),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 text-xs text-gray-500",children:[e.jsx("span",{children:"Fewer"}),e.jsx("div",{className:"flex",children:[.15,.35,.55,.75,.95].map((l,a)=>e.jsx("div",{className:"w-5 h-4",style:{backgroundColor:`rgba(79, 70, 229, ${l})`}},a))}),e.jsx("span",{children:"More references"})]})]})})()]}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-3",children:"Featured Sermon Series"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-6",children:Object.entries(Xe).map(([t,n])=>{const s=ls(t),o=He.has(t),r={amber:{bg:"bg-amber-50",border:"border-amber-200",header:"bg-amber-100",text:"text-amber-800",badge:"bg-amber-600"},indigo:{bg:"bg-indigo-50",border:"border-indigo-200",header:"bg-indigo-100",text:"text-indigo-800",badge:"bg-indigo-600"}}[n.color]||{bg:"bg-gray-50",border:"border-gray-200",header:"bg-gray-100",text:"text-gray-800",badge:"bg-gray-600"};return e.jsxs("div",{className:`rounded-lg border ${r.border} overflow-hidden`,children:[e.jsxs("button",{onClick:()=>Te(l=>{const a=new Set(l);return a.has(t)?a.delete(t):a.add(t),a}),className:`w-full p-3 ${r.header} flex items-center justify-between transition hover:opacity-90`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{name:"book",size:18,className:r.text}),e.jsx("span",{className:`font-bold ${r.text}`,children:t}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full text-white ${r.badge}`,children:[s.length," sermons"]})]}),e.jsx(u,{name:o?"chevronUp":"chevronDown",size:18,className:r.text})]}),o&&e.jsxs("div",{className:`${r.bg} p-3`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:n.description}),e.jsx("div",{className:"flex gap-1 flex-shrink-0 ml-2",children:e.jsxs("button",{onClick:l=>{l.stopPropagation(),be(s,`WMB_${t.replace(/[^a-zA-Z0-9]+/g,"_")}.zip`,t)},disabled:S!==null,className:"px-2 py-0.5 text-xs bg-amber-500 text-white rounded hover:bg-amber-600 transition disabled:opacity-50 flex items-center gap-1",title:`Download all ${s.length} sermons as ZIP`,children:[e.jsx(u,{name:"download",size:12})," ZIP (",s.length,")"]})})]}),e.jsx("div",{className:"space-y-1",children:s.map(l=>e.jsxs("button",{onClick:()=>{B(l),H(0)},className:"w-full text-left p-2 bg-white rounded border hover:bg-gray-50 transition flex justify-between items-center group",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-800 text-sm truncate",children:l.title}),e.jsx("div",{className:"text-xs text-gray-500",children:l.date})]}),e.jsx(u,{name:"chevronRight",size:14,className:"text-gray-400 group-hover:text-gray-600 flex-shrink-0 ml-2"})]},l.id))})]})]},t)})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-3",children:"Top Topics"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:Object.entries(Bt).slice(0,12).map(([t,n])=>{const s=He.has(`topic-${t}`),o=`topic-${t}`,r=pt[o]||"",l=h.filter(d=>d.topics&&d.topics.includes(t)).sort((d,i)=>(d.date||"").localeCompare(i.date||"")),a=s?r?l.filter(d=>d.title.toLowerCase().includes(r.toLowerCase())||(d.date||"").includes(r)):l:[];return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>Te(d=>{const i=new Set(d),m=`topic-${t}`;return i.has(m)?i.delete(m):i.add(m),i}),className:`w-full p-3 flex justify-between items-center transition ${s?"bg-gray-100":"bg-gray-50 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"font-medium text-gray-700",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[n," sermons"]}),e.jsx(u,{name:s?"chevronUp":"chevronDown",size:14,className:"text-gray-400"})]})]}),s&&e.jsxs("div",{className:"bg-white border-t max-h-80 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-50 p-2 border-b space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[a.length," sermons",r&&" (filtered)"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:d=>{d.stopPropagation(),be(a,`WMB_${t.replace(/[^a-zA-Z0-9]+/g,"_")}_Sermons.zip`,t)},disabled:S!==null,className:"px-2 py-0.5 text-xs bg-amber-500 text-white rounded hover:bg-amber-600 transition disabled:opacity-50 flex items-center gap-1",title:`Download all ${a.length} sermons about ${t} as ZIP`,children:[e.jsx(u,{name:"download",size:12})," ZIP (",a.length,")"]}),e.jsx("button",{onClick:d=>{d.stopPropagation();const i=a.map(j=>`${j.date} - ${j.title}`).join(`
`),m=new Blob([i],{type:"text/plain"}),x=URL.createObjectURL(m),g=document.createElement("a");g.href=x,g.download=`WMB_${t.replace(/[^a-zA-Z0-9]+/g,"_")}_Index.txt`,g.click(),URL.revokeObjectURL(x)},className:"px-2 py-0.5 text-xs bg-gray-400 text-white rounded hover:bg-gray-500 transition",title:`Download index of ${a.length} sermons`,children:"Index"})]})]}),e.jsx("input",{type:"text",placeholder:"Search sermons...",value:r,onClick:d=>d.stopPropagation(),onChange:d=>bt(i=>({...i,[o]:d.target.value})),className:"w-full text-xs border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-amber-500"})]}),e.jsxs("div",{className:"p-2",children:[a.map(d=>e.jsxs("div",{className:"flex items-center gap-1 hover:bg-gray-50 rounded transition",children:[e.jsxs("button",{onClick:()=>{B(d),H(0)},className:"flex-1 text-left p-2 flex justify-between items-center text-sm min-w-0",children:[e.jsx("span",{className:"truncate text-gray-800",children:d.title}),e.jsx("span",{className:"text-xs text-gray-500 ml-2 flex-shrink-0",children:d.date})]}),e.jsx("a",{href:d.lwbUrl||"https://www.livingwordbroadcast.org/wbtextindex",target:"_blank",rel:"noopener noreferrer",title:"Download from Living Word Broadcast",className:"p-2 text-gray-400 hover:text-amber-600 flex-shrink-0",children:e.jsx(u,{name:"download",size:14})})]},d.id)),a.length===0&&r&&e.jsxs("p",{className:"text-xs text-gray-400 text-center py-4",children:['No sermons match "',r,'"']})]})]})]},t)})})]}),e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:[e.jsx(u,{name:"location",className:"inline mr-2",size:20}),"Browse by Venue (",ot.length,")"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Click a venue to see all sermons preached there"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 max-h-96 overflow-y-auto",children:ee.slice(0,30).map(t=>{const n=He.has(`venue-${t.venue}`),s=`venue-${t.venue}`,o=pt[s]||"",r=h.filter(a=>a.venue===t.venue).sort((a,d)=>(a.date||"").localeCompare(d.date||"")),l=n?o?r.filter(a=>a.title.toLowerCase().includes(o.toLowerCase())||(a.date||"").includes(o)):r:[];return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>Te(a=>{const d=new Set(a),i=`venue-${t.venue}`;return d.has(i)?d.delete(i):d.add(i),d}),className:`w-full p-3 flex justify-between items-center transition ${n?"bg-blue-50":"bg-gray-50 hover:bg-gray-100"}`,children:[e.jsxs("div",{className:"text-left min-w-0 flex-1",children:[e.jsx("span",{className:"font-medium text-gray-700 truncate block",children:t.venue}),t.dateRange&&t.dateRange!=="N/A"&&e.jsx("span",{className:"text-xs text-gray-400",children:t.dateRange})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:t.count}),e.jsx(u,{name:n?"chevronUp":"chevronDown",size:14,className:"text-gray-400"})]})]}),n&&e.jsxs("div",{className:"bg-white border-t max-h-80 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-50 p-2 border-b",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[l.length,o?` of ${r.length}`:""," sermons"]}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("button",{onClick:a=>{a.stopPropagation(),be(r,`WMB_${t.venue.replace(/[^a-zA-Z0-9]+/g,"_")}_Sermons.zip`,t.venue)},disabled:S!==null,className:"px-2 py-0.5 text-xs bg-amber-500 text-white rounded hover:bg-amber-600 transition disabled:opacity-50 flex items-center gap-1",title:`Download all ${r.length} sermons from ${t.venue} as ZIP`,children:[e.jsx(u,{name:"download",size:12})," ZIP"]})})]}),e.jsx("input",{type:"text",placeholder:"Search sermons...",value:o,onChange:a=>bt(d=>({...d,[s]:a.target.value})),onClick:a=>a.stopPropagation(),className:"w-full px-2 py-1 text-xs border rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"p-2",children:[l.map(a=>e.jsxs("button",{onClick:()=>{B(a),H(0)},className:"w-full text-left p-2 hover:bg-gray-50 rounded transition flex justify-between items-center text-sm",children:[e.jsx("span",{className:"truncate text-gray-800 flex-1 min-w-0",children:a.title}),e.jsx("span",{className:"text-xs text-gray-500 ml-2 flex-shrink-0",children:a.date})]},a.id)),l.length===0&&o&&e.jsxs("p",{className:"text-xs text-gray-400 text-center py-2",children:['No sermons match "',o,'"']})]})]})]},t.venue)})})]})]}),Se==="data"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[e.jsx(u,{name:"calendar",className:"inline mr-2",size:20}),"All Transcripts by Year"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Click a year to expand and see all sermons. Click a sermon to view its full transcript."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>be(h,"WMB_All_Sermons.zip","all"),disabled:S!==null,className:"px-4 py-2 bg-amber-600 hover:bg-amber-700 disabled:bg-amber-400 text-white rounded-lg text-sm font-medium transition flex items-center gap-2 whitespace-nowrap",children:[e.jsx(u,{name:"download",size:16}),S?.year==="all"?`Downloading ${S.current}/${S.total}...`:`Download All (${h.length})`]})})]}),S&&e.jsx("div",{className:"mb-4 bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-amber-600 border-t-transparent rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-medium text-amber-800",children:["Downloading ",S.year==="all"?"all transcripts":`${S.year} transcripts`,"..."]}),e.jsxs("div",{className:"text-xs text-amber-600",children:[S.current," of ",S.total," files"]})]}),e.jsx("div",{className:"w-32 bg-amber-200 rounded-full h-2",children:e.jsx("div",{className:"bg-amber-600 h-2 rounded-full transition-all",style:{width:`${S.current/S.total*100}%`}})})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>ts(!Je),className:"flex items-center gap-2 text-sm font-medium text-amber-600 hover:text-amber-800 mb-3",children:[e.jsx(u,{name:Je?"chevronDown":"chevronRight",size:16}),e.jsx(u,{name:"search",size:14}),Je?"Hide":"Open"," Searchable Sermon Database (",h.length.toLocaleString()," sermons)"]}),Je&&e.jsxs("div",{className:"border rounded-lg p-4 bg-amber-50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(u,{name:"search",size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Filter by title, venue, location, date...",value:qe,onChange:t=>ft(t.target.value),className:"w-full pl-9 pr-8 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"}),qe&&e.jsx("button",{onClick:()=>ft(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(u,{name:"x",size:14})})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Filters metadata only. Use the search engine on the Search & Stats tab to search sermon content."})]}),(()=>{const t=qe.trim().toLowerCase();let n=h.slice();t&&(n=n.filter(a=>(a.title||"").toLowerCase().includes(t)||(a.venue||"").toLowerCase().includes(t)||(a.location||"").toLowerCase().includes(t)||(a.date||"").toLowerCase().includes(t)));const s=ss;n.sort((a,d)=>{let i=a[s.key]||"",m=d[s.key]||"";if(s.key==="date"&&(i||(i="0000-00-00"),m||(m="0000-00-00")),s.key==="wordCount"){i=a.wordCount||0,m=d.wordCount||0;const g=i-m;return s.direction==="desc"?-g:g}const x=String(i).localeCompare(String(m));return s.direction==="desc"?-x:x});const o=100,r=n.length>o,l=n.slice(0,o);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t?e.jsxs(e.Fragment,{children:["Showing ",l.length.toLocaleString(),r?"+":""," of ",n.length.toLocaleString()," matching sermons"]}):e.jsxs(e.Fragment,{children:["Showing ",l.length.toLocaleString()," of ",h.length.toLocaleString()," sermons (use search to filter)"]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto border rounded bg-white overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm min-w-[800px]",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-50 border-b z-10",children:e.jsxs("tr",{className:"text-gray-600 text-left",children:[e.jsxs("th",{className:"p-2 font-medium w-24 cursor-pointer hover:bg-gray-100 select-none",onClick:()=>Re(a=>({key:"date",direction:a.key==="date"&&a.direction==="desc"?"asc":"desc"})),children:["Date ",s.key==="date"&&e.jsx("span",{className:"ml-1",children:s.direction==="desc"?"â†“":"â†‘"})]}),e.jsxs("th",{className:"p-2 font-medium cursor-pointer hover:bg-gray-100 select-none",onClick:()=>Re(a=>({key:"title",direction:a.key==="title"&&a.direction==="asc"?"desc":"asc"})),children:["Title ",s.key==="title"&&e.jsx("span",{className:"ml-1",children:s.direction==="asc"?"â†‘":"â†“"})]}),e.jsxs("th",{className:"p-2 font-medium hidden sm:table-cell cursor-pointer hover:bg-gray-100 select-none",onClick:()=>Re(a=>({key:"venue",direction:a.key==="venue"&&a.direction==="asc"?"desc":"asc"})),children:["Venue ",s.key==="venue"&&e.jsx("span",{className:"ml-1",children:s.direction==="asc"?"â†‘":"â†“"})]}),e.jsxs("th",{className:"p-2 font-medium hidden md:table-cell cursor-pointer hover:bg-gray-100 select-none",onClick:()=>Re(a=>({key:"location",direction:a.key==="location"&&a.direction==="asc"?"desc":"asc"})),children:["Location ",s.key==="location"&&e.jsx("span",{className:"ml-1",children:s.direction==="asc"?"â†‘":"â†“"})]}),e.jsxs("th",{className:"p-2 font-medium text-right hidden md:table-cell cursor-pointer hover:bg-gray-100 select-none",onClick:()=>Re(a=>({key:"wordCount",direction:a.key==="wordCount"&&a.direction==="desc"?"asc":"desc"})),children:["Words ",s.key==="wordCount"&&e.jsx("span",{className:"ml-1",children:s.direction==="desc"?"â†“":"â†‘"})]}),e.jsx("th",{className:"p-2 font-medium text-center",children:"Source"}),e.jsx("th",{className:"p-2 font-medium text-center",children:"Download"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"py-8 text-center text-gray-500",children:"No sermons match your search."})}):l.map((a,d)=>e.jsxs("tr",{className:"hover:bg-amber-50 cursor-pointer",onClick:()=>B(a),children:[e.jsx("td",{className:"p-2 text-gray-600 whitespace-nowrap",children:a.date||"Unknown"}),e.jsx("td",{className:"p-2 font-medium text-gray-800",children:a.title||"Untitled"}),e.jsx("td",{className:"p-2 text-gray-600 hidden sm:table-cell",children:a.venue||"â€”"}),e.jsx("td",{className:"p-2 text-gray-600 hidden md:table-cell",children:a.location||"â€”"}),e.jsx("td",{className:"p-2 text-right text-gray-500 hidden md:table-cell",children:a.wordCount?.toLocaleString()||"â€”"}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("a",{href:"https://www.livingwordbroadcast.org/wbtextindex",target:"_blank",rel:"noopener noreferrer",onClick:i=>i.stopPropagation(),className:"text-xs text-amber-600 hover:text-amber-800 font-medium",children:"LWB â†—"})}),e.jsx("td",{className:"p-2 text-center",children:a.path&&e.jsxs("a",{href:`/analytics/${Ve(a.path)}`,download:!0,onClick:i=>i.stopPropagation(),className:"text-xs text-blue-600 hover:text-blue-800 font-medium inline-flex items-center gap-1",title:"Download transcript",children:[e.jsx(u,{name:"download",size:12})," TXT"]})})]},d))})]})}),r&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2 text-center",children:["Showing first ",o," results. Use search to narrow down."]})]})})()]})]}),e.jsx("div",{className:"space-y-2",children:us.map(({year:t,sermons:n,count:s,totalWords:o})=>{const r=Gt.has(t),l=Xt[t]||"",a=Qt[t]||{key:"date",direction:"asc"},d=n.filter(i=>{if(!l)return!0;const m=l.toLowerCase();return(i.title||"").toLowerCase().includes(m)||(i.venue||"").toLowerCase().includes(m)||(i.date||"").toLowerCase().includes(m)}).sort((i,m)=>{const x=a.direction==="asc"?1:-1;return a.key==="date"?x*(i.date||"").localeCompare(m.date||""):a.key==="title"?x*(i.title||"").localeCompare(m.title||""):a.key==="venue"?x*(i.venue||"").localeCompare(m.venue||""):0});return e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:`flex items-center justify-between p-4 transition-colors ${r?"bg-amber-100":"bg-amber-50 hover:bg-amber-100"}`,children:[e.jsxs("button",{onClick:()=>{qt(i=>{const m=new Set(i);return m.has(t)?m.delete(t):m.add(t),m})},className:"flex items-center gap-3 flex-1 text-left",children:[e.jsx(u,{name:r?"chevronDown":"chevronRight",size:18,className:"text-amber-600"}),e.jsx("span",{className:"text-lg font-bold text-amber-800",children:t}),e.jsxs("span",{className:"text-sm text-amber-600",children:["(",s," sermons)"]}),e.jsxs("span",{className:"text-sm text-amber-700 ml-auto mr-4",children:[(o/1e3).toFixed(0),"K words"]})]}),e.jsxs("button",{onClick:i=>{i.stopPropagation();const m=n.filter(f=>f.path);if(m.length===0){alert("No downloadable transcripts for this year");return}const x=`William Branham Sermons - ${t}
${"=".repeat(40)}

${m.length} sermons

Download each transcript from Living Word Broadcast:
https://www.livingwordbroadcast.org/wbtextindex

--- Sermon List ---

${m.map(f=>`${f.date} - ${f.title}
  Venue: ${f.venue||"Unknown"}
  Words: ${f.wordCount?.toLocaleString()||"N/A"}`).join(`

`)}`,g=new Blob([x],{type:"text/plain"}),j=URL.createObjectURL(g),b=document.createElement("a");b.href=j,b.download=`WMB_Sermons_${t}_Index.txt`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(j)},className:"px-2 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-xs font-medium transition flex items-center gap-1",title:`Download index for ${t}`,children:[e.jsx(u,{name:"fileText",size:12})," Index"]}),e.jsxs("button",{onClick:i=>{i.stopPropagation(),be(n,`WMB_Sermons_${t}.zip`,t)},disabled:S!==null,className:"px-2 py-1.5 bg-amber-600 hover:bg-amber-700 disabled:bg-amber-400 text-white rounded text-xs font-medium transition flex items-center gap-1",title:`Download all ${s} transcripts for ${t} as ZIP`,children:[e.jsx(u,{name:"download",size:12}),S?.year===t?`${S.current}/${S.total}`:`ZIP (${s})`]})]}),r&&e.jsxs("div",{className:"bg-white border-t p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(u,{name:"search",size:14,className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search sermons by title, venue, or date...",value:l,onChange:i=>gt(m=>({...m,[t]:i.target.value})),className:"w-full pl-7 pr-3 py-1.5 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-amber-500"}),l&&e.jsx("button",{onClick:()=>gt(i=>({...i,[t]:""})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(u,{name:"x",size:12})})]}),e.jsxs("div",{className:"flex gap-1 text-xs",children:[e.jsx("span",{className:"text-gray-500 self-center mr-1",children:"Sort:"}),["date","title","venue"].map(i=>e.jsxs("button",{onClick:()=>es(m=>({...m,[t]:{key:i,direction:m[t]?.key===i&&m[t]?.direction==="asc"?"desc":"asc"}})),className:`px-2 py-1 rounded ${a.key===i?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[i.charAt(0).toUpperCase()+i.slice(1),a.key===i&&(a.direction==="asc"?" â†‘":" â†“")]},i))]})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm min-w-[800px]",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium text-gray-600",children:"Date"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-600",children:"Title"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-600 hidden sm:table-cell",children:"Venue"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-600 hidden md:table-cell",children:"Location"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-600 hidden md:table-cell",children:"Words"}),e.jsx("th",{className:"text-center p-2 font-medium text-gray-600",children:"Source"}),e.jsx("th",{className:"text-center p-2 font-medium text-gray-600",children:"Download"})]})}),e.jsx("tbody",{children:d.map((i,m)=>e.jsxs("tr",{onClick:()=>{B(i),H(0)},className:"border-t cursor-pointer hover:bg-amber-50 transition-colors",children:[e.jsx("td",{className:"p-2 text-gray-600 whitespace-nowrap",children:i.date}),e.jsx("td",{className:"p-2 font-medium text-gray-800",children:i.title}),e.jsx("td",{className:"p-2 text-gray-600 hidden sm:table-cell",children:i.venue}),e.jsx("td",{className:"p-2 text-gray-600 hidden md:table-cell",children:i.location||"â€”"}),e.jsx("td",{className:"p-2 text-gray-500 text-right hidden md:table-cell",children:i.wordCount?.toLocaleString()}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("a",{href:"https://www.livingwordbroadcast.org/wbtextindex",target:"_blank",rel:"noopener noreferrer",onClick:x=>x.stopPropagation(),className:"text-xs text-amber-600 hover:text-amber-800 font-medium",children:"LWB â†—"})}),e.jsx("td",{className:"p-2 text-center",children:i.path&&e.jsxs("a",{href:`/analytics/${Ve(i.path)}`,download:!0,onClick:x=>x.stopPropagation(),className:"text-xs text-blue-600 hover:text-blue-800 font-medium inline-flex items-center gap-1",children:[e.jsx(u,{name:"download",size:12})," TXT"]})})]},i.id||m))})]}),d.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No sermons match your search."})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 pt-2 border-t",children:["Showing ",d.length," of ",s," sermons"]})]})]},t)})})]})}),Se==="about"&&e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"About This Archive"}),e.jsxs("div",{className:"prose prose-sm max-w-none text-gray-600",children:[e.jsxs("p",{children:["This searchable archive contains ",e.jsxs("strong",{children:[N.toLocaleString()," sermon transcripts"]})," from William Branham's ministry spanning ",e.jsx("strong",{children:rt}),"."]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mt-6 mb-2",children:"Features"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Full-text search"})," with regex and boolean operators (AND, OR, NOT, NEAR)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Topic filtering"})," by detected sermon themes"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Timeline visualization"})," of sermons and search results"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Venue breakdown"})," showing where sermons were preached"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Direct links"})," to Living Word Broadcast for each sermon"]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mt-6 mb-2",children:"Data Source"}),e.jsxs("p",{children:["All transcripts are sourced from ",e.jsx("a",{href:"https://www.livingwordbroadcast.org/wbtextindex",target:"_blank",rel:"noopener noreferrer",className:"text-amber-600 hover:text-amber-800",children:"Living Word Broadcast"}),"."]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mt-6 mb-2",children:"Search Tips"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"seven seals"})," - Find exact phrase"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"bride AND rapture"})," - Both terms required"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"prophet OR messenger"})," - Either term"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"healing NOT cancer"})," - Exclude a term"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"seal* "})," - Wildcard (seals, sealed, etc.)"]})]})]})]})]}),ce&&e.jsx(Ms,{sermon:ce,searchTerm:ce.searchTerm,wholeWords:it.current?.wholeWords!==!1,onClose:()=>B(null),focusIndex:Yt,onFocusChange:H,onSaveProgress:ns,resumePosition:ce.resumePosition,relatedSermons:is(ce),onSelectRelated:t=>{B({...t,searchTerm:le||y}),H(0)}}),$e&&(()=>{const t=h.filter(s=>s.venue===$e).sort((s,o)=>(s.date||"").localeCompare(o.date||"")),n=ee.find(s=>s.venue===$e);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>Ie(null),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-amber-600 text-white p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:$e}),e.jsxs("p",{className:"text-amber-100 text-sm",children:[t.length," sermons â€¢ ",n?.dateRange||"Unknown dates"]})]}),e.jsx("button",{onClick:()=>Ie(null),className:"text-white/80 hover:text-white p-1",children:e.jsx(u,{name:"x",size:24})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(80vh-80px)]",children:e.jsx("div",{className:"space-y-1",children:t.map(s=>e.jsxs("button",{onClick:()=>{B(s),H(0),Ie(null)},className:"w-full text-left p-3 hover:bg-amber-50 rounded-lg transition flex justify-between items-center border border-transparent hover:border-amber-200",children:[e.jsx("span",{className:"text-gray-800 flex-1 min-w-0 truncate",children:s.title}),e.jsx("span",{className:"text-sm text-gray-500 ml-3 flex-shrink-0",children:s.date})]},s.id))})})]})})})(),ut&&e.jsx(Rs,{...ut,onClose:()=>Kt(null),onSermonSelect:t=>{B({...t,searchTerm:le||y}),H(0)}})]})})}export{Fs as default};
